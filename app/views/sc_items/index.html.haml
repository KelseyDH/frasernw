- title "Content Items"

.content-wrapper

  %h2 Content Items
  
  - categories = ScCategory.all.reject{ |category| category.parent.present? || category.owned_sc_items_in_divisions(current_user_divisions).blank? }

  .tabbable
    %ul.nav.nav-tabs
      - active = true
      - categories.each do |category|
        %li{:class => active && "active"}
          %a{"href" => "##{category.name.remove_whitespace}_tab", "data-toggle" => "tab"}= category.name
        - active = false

  
    .tab-content
      - active = true
      - categories.each do |category|
        .tab-pane{"id" => "#{category.name.remove_whitespace}_tab", :class => active && "active"}
          %table.table.table-condensed.table-striped
            %tr
              %th Title
              %th Subcategory
              %th Specialties
              %th Type
              %th Searchable?
              %th Shared Care?
              %th.admin

            - category.owned_sc_items_in_divisions(current_user_divisions).each do |sc_item|
              %tr
                %td{"width" => "40%"}= link_to sc_item.title, sc_item, :class => 'ajax'
                %td= sc_item.sc_category != category ? (link_to sc_item.sc_category.name, sc_item.sc_category, :class => 'ajax') : ""
                %td
                  %ul
                    - sc_item.sc_item_specializations.each do |is|
                      %li
                        = link_to is.specialization.name, is.specialization, :class => 'ajax'
                        - if is.procedure_specializations.present?
                          = ": #{is.procedure_specializations.map{ |ps| link_to ps.procedure.name, ps.procedure, :class => 'ajax' }.to_sentence}".html_safe
                %td= sc_item.type
                %td= sc_item.searchable ? "Yes" : "No"
                %td= sc_item.shared_care? ? "Yes" : "No"
                %td.admin.btn-group
                  = link_to("<i class='icon-pencil'></i>".html_safe + " Edit", edit_sc_item_path(sc_item), :class => "btn btn-mini ajax")
                  = link_to("<i class='icon-trash'></i>".html_safe + " Delete", sc_item, :confirm => "Delete #{sc_item.title}?", :method => :delete, :class => "btn btn-mini")
        - active = false

  %p.admin= link_to("<i class='icon-plus-sign'></i>".html_safe + " New Content Item", new_sc_item_path, :class => "btn ajax")
