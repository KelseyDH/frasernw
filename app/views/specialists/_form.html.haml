/ a bit messy, and probably there is a better way of handling multiple controllers reusing this form
- form_method    = params[:action]     == 'new' ? :post   : :put
- current_action = params[:action]     == 'new' ? :create : :update
- form_action    = params[:controller] == 'specialists_editor' ? :update : current_action

= simple_nested_form_for @specialist, :url => {:controller => params[:controller], :action => form_action}, :method => form_method do |f|
  = f.error_messages
  - if @view
    .error_messages
      %h2 You are editing your record in the Fraser NW Division of Family Practice Resource database
      %p This database exists to make make our practices, and your practice more efficient. By providing the information requested below you are making it easier for family doctors to find your practice, ensure that they are providing you with the correct information, and that your scope of practice is fully understood.

  %fieldset
    %legend Office Information
    = f.input :firstname, label: 'First Name', wrapper_html: {class: 'firstname'}
    = f.input :lastname, label: 'Last Name', wrapper_html: {class: 'lastname'}
    = f.input :phone1, label: "Phone"
    = f.input :direct_phone, label: "Direct Phone"
    = f.input :fax
    %hr
    %p Address
    = f.input :address1, label: "Street Address"
    = f.input :address2, label: "Apt, Suite, Bldg. (Optional)"
    = f.input :city, wrapper_html: {class: 'city'}
    = f.input :province, wrapper_html: {class: 'province'}
    = f.input :postalcode, label: "Postal Code", wrapper_html: {class: 'postalcode'}

  - if current_user && current_user.admin?    
    %fieldset.contact
      %legend Senior MOA Contact Information
      Allow specialists to edit their own forms - this information is only visible to admins.
      = f.input :contact_name, label: "Name"
      = f.input :contact_email, label: "Email Address"
      = f.input :contact_phone, label: "Phone Number"
      = f.input :contact_notes, hint: "Include contact's role (MOA, etc.) and anything else we should know."

  -#= f.input :responds_via, :as => :text, :hint => "How does the Dr. respond to referral requests (phone to GP office, fax to GP office, phone to patient, other...)"
  -# FIXME - deprecated field?

  = f.input :status, as: :text

  = f.input :all_procedure_info

  .nested
    %label Pertinent Areas of Practice/Expertise
    %p
      Indicate Information and Investigations Required in the Text Field
      %br
      %span.quiet (e.g. XRs, MRI, scans, blood work etc. in addition to: History, PH, Meds, Allergies, Pt. Stability, Previous OR / Consultation Reports)

    = f.simple_fields_for :capacities do |i|
      = i.association :procedure, as: :select, label: false, collection: @specialist.specialization.procedures.done_by_specialists, wrapper: false
      = i.input :investigation, label: false, wrapper: false
      = i.hidden_field :_destroy
      = i.link_to_remove "Ã—", class: "button"
    = f.link_to_add "Add an Area of Expertise", :capacities, class: "button"

  = f.input :interest, as: :text, label: "Most interested in"
  = f.input :not_interested, label: "Does not see or do"

  .referals
    = f.input :referral_criteria, as: :text, label: "Referral Details", hint: "Criteria for referral, what forms and investigations are required for referrals for different procedures", wrapper: false

    = f.input :red_flags, as: :text, hint: "Urgent situations, and process for having them addressed", wrapper: false
    = f.input :waittime, label: "Wait Time", hint: "in weeks", as: :integer, input_html: {min: 0}

  = f.association :hospitals, as: :check_boxes, label: "Hospital Privileges"
  = f.association :clinics, as: :check_boxes, label: "Sub-Specialty Clinics", collection: @specialization_clinics

  -# FIXME - This shouldn't be in the view. Should be set by parent resource in controller.
  = f.input :specialization_id, as: :hidden

  = f.submit
