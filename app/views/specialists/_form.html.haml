/ a bit messy, and probably there is a better way of handling multiple controllers reusing this form
- form_method    = params[:action]     == 'new' ? :post   : :put
- current_action = params[:action]     == 'new' ? :create : :update
- form_action    = params[:controller] == 'specialists_editor' ? :update : current_action

= simple_nested_form_for @specialist, :url => {:controller => params[:controller], :action => form_action}, :method => form_method do |f|
  = f.error_messages
  - if @view
    .error_messages
      %h2 You are editing your record in the Fraser NW Division of Family Practice Resource database
      %p This database exists to make make our practices, and your practice more efficient. By providing the information requested below you are making it easier for family doctors to find your practice, ensure that they are providing you with the correct information, and that your scope of practice is fully understood.

  %fieldset
    %h2 
      Specialist: 
      =@specialization.name
    = f.input :firstname, label: 'First Name'
    = f.input :lastname, label: 'Last Name'

  %fieldset.contact_info
    %h2 Office / Contact Information
    = f.input :phone1, label: "Phone"
    = f.input :direct_phone, label: "Direct Phone"
    = f.input :fax

    = f.input :address1, label: "Street Address"
    = f.input :address2, label: "Apt, Suite, Bldg. (Optional)"
    = f.input :city
    = f.input :province
    = f.input :postalcode, label: "Postal Code"

  - if current_user && current_user.admin?    
    %fieldset
      %h2 Senior MOA Contact Information
      %p Allows specialists to edit their own form. This information is only visible to admins.
      = f.input :contact_name, label: "Name"
      = f.input :contact_email, label: "Email"
      = f.input :contact_phone, label: "Phone"
      = f.input :contact_notes, label: "Notes", hint: "Include contact's role (MOA, etc.) and anything else we should know."

  %fieldset
    %h2 Status
    = f.input :status, as: :text, label: "Details"

  %fieldset.nested
    %h2 Areas of Practise
    = f.input :required_investigations, label: "Required Investigations", hint: 'in addition to history, PH, meds, allergies and previous OR/consultation reports for all patients'
    
    %h3 Pertinent Areas of Practice/Expertise
    %p
      Indicate Information and Investigations Required in the Text Field
      %br
      %span.quiet (e.g. XRs, MRI, scans, blood work etc. in addition to: History, PH, Meds, Allergies, Pt. Stability, Previous OR / Consultation Reports)

    = f.simple_fields_for :capacities do |i|
      = i.association :procedure, as: :select, label: false, collection: @specialist.specialization.procedures.done_by_specialists, wrapper: false
      = i.input :investigation, label: false, wrapper: false
      = i.hidden_field :_destroy
      = i.link_to_remove "Ã—", class: "button"
    = f.link_to_add "Add an Area of Expertise", :capacities, class: "button"

    %hr

    = f.input :interest, as: :text, label: "Interested In"
    = f.input :not_performed, as: :text, label: "Does not see or do"

  %fieldset.referral_details
    %h2 Referral Details
    = f.input :responds_via, :as => :text, :hint => "How does the Dr. respond to referral requests (phone to GP office, fax to GP office, phone to patient, other...)"
    = f.input :referral_mechanism, label: "Mechanism(s) of Referral", hint: "fax, phone, other (please explain)"
    -# = f.input :referral_criteria, as: :text, hint: "Criteria for referral, what forms and investigations are required for referrals for different procedures"
    = f.input :lagtime, label: "Booking Lag", hint: "in weeks", as: :integer, input_html: {min: 0}
    = f.input :referral_request, label: "Referral Request", hint: "To office or directly to patient"
    = f.input :patient_can_book, as: :select, label: "Patient can book appointment?"
    = f.input :red_flags, label: "Red Flags", as: :text, hint: "Urgent situations, and process for having them addressed"
    = f.input :waittime, label: "Wait Time", hint: "in weeks", as: :integer, input_html: {min: 0}
    = f.input :urgent_mechanism, label: "Urgent Referral Contact", hint: "fax, phone, other (please explain)"

  %fieldset
    %h2 Hospital Privileges
    = f.association :hospitals, as: :check_boxes, label: false
    = link_to "Add a Hospital", new_hospital_path, class: "button"
  
  %fieldset
    %h2 Sub-Specialty Clinics
    = f.association :clinics, as: :check_boxes, label: false, collection: @specialization_clinics
    = link_to "Add a Clinic", new_specialization_clinic_path(@specialization), class: "button"


  -# FIXME - This shouldn't be in the view. Should be set by parent resource in controller.
  %p
    = f.input :specialization_id, as: :hidden

    = f.submit
