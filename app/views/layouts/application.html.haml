!!!
%html

  %head
    %title= yield(:title) || "Pathways"
    %meta{"http-equiv"=>"Content-Type", :content=>"text/html; charset=utf-8"}
    %meta{"name"=>"viewport", :content=>"initial-scale=1.0"}

    = stylesheet_link_tag "application", :media => 'screen, print'
    = stylesheet_link_tag "print", :media => 'print'
    = javascript_include_tag "application"
    = javascript_include_tag '../livesearch'
    = csrf_meta_tag
    = yield(:head)
              
    :javascript
      $(document).ready(function() 
      {
        $('#search').livesearch({
          container: '#search_results',
          data: pathways_search_data,
          scorer: pathways_scorer,
          grouper: pathways_grouper,
          searcher: pathways_searcher,
          data_formatter: pathways_data_formatter,
          group_formatter: pathways_group_formatter,
          min_score: 0.8
        });
      });

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-32752873-1']);
      _gaq.push(['_trackPageview']);
      _gaq.push(['_setCustomVar', 1, 'ID', '#{current_user_id}', 1]);
      _gaq.push(['_setCustomVar', 2, 'Type', '#{current_user_type_mask}', 1]);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

  %body{:id => "#{params[:controller]}_page"}
    #main-nav.navbar
      .navbar-inner
        .container
        
          %a.btn.btn-navbar{"data-toggle" => "collapse", "data-target" => ".nav-collapse"}
            %span.icon-bar
            %span.icon-bar
            %span.icon-bar
            
          %a#logo.brand.ajax{"href" => root_url}
          
          .nav-collapse
            - if logged_in?
              
              %form.navbar-search.pull-right
                %input.span3.search-query#search{"type" => "search", "placeholder" => "Search"}
                #search_results
                  %ul
                  
              %ul.nav.pull-right
              
                %li.dropdown
                  %a.ajax{"href" => root_url} Home
                  
                - if current_user_is_admin?
                
                  %li.dropdown.admin
                    %a.dropdown-toggle{"href" => "#", "data-toggle" => "dropdown"}
                      Admin
                      - user_review_item_count = ReviewItem.active.reject{ |ri| !current_user.owns(ri.item.specializations) }.count
                      - user_feedback_item_count = FeedbackItem.active.reject{ |fi| !current_user.owns(fi.item.specializations) }.count
                      - total_review_item_count = ReviewItem.active.count
                      - total_feedback_item_count = FeedbackItem.active.count
                      -  if total_review_item_count + total_feedback_item_count > 0
                        (#{user_review_item_count + user_feedback_item_count}/#{total_review_item_count + total_feedback_item_count})
                      %b.caret
                      
                    %ul.dropdown-menu
                      /%li= link_to "Track Specialists", tracker_path
                      %li= link_to "Activity Feed", all_versions_path, :class => "history ajax"
                      %li= link_to "Review Queue (#{user_review_item_count}/#{total_review_item_count})", review_items_path, :class => "review ajax"
                      %li= link_to "Feedback Queue (#{user_feedback_item_count}/#{total_feedback_item_count})", feedback_items_path, :class => "feedback ajax"
                      %li= link_to "Stats", stats_path, :class => "stats ajax"
                      %li.divider
                      %li.nav-header Pathways
                      %li
                        = link_to "New...", "#", :class => "create arrow-right-after"
                        %ul.dropdown-menu
                          %li
                            = link_to "New Area of Practice in...", "#", :class => "arrow-right-after"
                            %ul.dropdown-menu.sub-menu
                              - Specialization.all.each do |specialization|
                                %li=link_to specialization.name, new_specialization_procedure_path(specialization), :class => "ajax"
                          %li= link_to "New City", new_city_path, :class => "ajax"
                          %li
                            = link_to "New Clinic in...", "#", :class => "arrow-right-after"
                            %ul.dropdown-menu
                              - Specialization.all.each do |specialization|
                                %li=link_to specialization.name, new_specialization_clinic_path(specialization), :class => "ajax"
                          %li= link_to "New Healthcare Provider", new_healthcare_provider_path, :class => "ajax"
                          %li= link_to "New Hospital", new_hospital_path, :class => "ajax"
                          %li= link_to "New Language", new_language_path, :class => "ajax"
                          %li= link_to "New Office", new_office_path, :class => "ajax"
                          %li
                            = link_to "New Specialist in...", "#", :class => "arrow-right-after"
                            %ul.dropdown-menu
                              - Specialization.all.each do |specialization|
                                %li=link_to specialization.name, new_specialization_specialist_path(specialization), :class => 'ajax'
                          %li= link_to "New Specialty", new_specialization_path, :class => "ajax"
                          %li= link_to "New User", new_user_path, :class => "ajax"
                      %li= link_to "Areas of Practice", procedures_path, :class => "ajax"
                      %li= link_to "Cities", cities_path, :class => "ajax"
                      %li= link_to "Clinics", clinics_path, :class => "ajax"
                      %li= link_to "Healthcare Providers", healthcare_providers_path, :class => "ajax"
                      %li= link_to "Hospitals", hospitals_path, :class => "ajax"
                      %li= link_to "Languages", languages_path, :class => "ajax"
                      %li
                        = link_to "Offices", "#", :class => "arrow-right-after"
                        %ul.dropdown-menu
                          %li=link_to "All Offices", offices_path, :class => "ajax"
                          - City.all.each do |city|
                            %li=link_to "Offices in #{city.name}", city_offices_path(city), :class => 'office ajax'
                      %li= link_to "Provinces", provinces_path, :class => "ajax"
                      %li= link_to "Specialists", specialists_path, :class => "ajax"
                      %li= link_to "Specialties", specializations_path, :class => "ajax"
                      %li= link_to "Users", users_path, :class => "ajax"
                      %li.divider
                      %li.nav-header Content Management
                      %li
                        = link_to "New...", "#", :class => "create arrow-right-after"
                        %ul.dropdown-menu
                          %li= link_to "New Content Category", new_sc_category_path, :class => "ajax"
                          %li= link_to "New Content Item", new_sc_item_path, :class => "ajax"
                      %li= link_to "Content Categories", sc_categories_path, :class => "sc_category ajax"
                      %li= link_to "Content Items", sc_items_path, :class => "sc_item ajax"
                  
                - ScCategory.global_nav.reject{ |category| category.sc_items.blank? }.each do |category|
                  - if category.show_as_dropdown?
                    %li.dropdown
                      %a.dropdown-toggle{"href" => "#", "data-toggle" => "dropdown"}
                        = category.name
                        %b.caret
                      %ul.dropdown-menu
                        - category.sc_items.each do |item|
                          - if item.link? || item.document?
                            %li= link_to item.title, item.link? ? item.url : item.document.url, :target => '_blank'
                          - else
                            %li= link_to item.title, item, :class => 'ajax'
                  - else
                    %li= link_to category.name, category, :class => 'ajax'
              
                %li.dropdown
                  %a.dropdown-toggle{"href" => "#", "data-toggle" => "dropdown"}
                    %i.icon-heart
                    Favourites
                    %b.caret
                    
                  %ul#favorites_dropdown.dropdown-menu
                        
                    %li#specialists_favorites.nav-header.specialist Specialists
                    - current_user.favorite_specialists.each do |s|
                      %li{"id" => "specialists_#{s.id}"}= link_to s.name, specialist_path(s), :class => 'ajax'
                        
                    %li#clinics_favorites.nav-header.clinic Clinics
                    - current_user.favorite_clinics.each do |c|
                      %li{"id" => "clinics_#{c.id}"}= link_to c.name, clinic_path(c), :class => 'ajax'
                        
                    %li#add_favorites
                      %p
                        Add specialists and clinics to this menu for quick reference by viewing their full details and pressing the
                        %i.icon-text.icon-heart
                        beside their name.
                          
                        
                    -if current_user.favorite_specialists.blank?
                      :javascript
                        $(document).ready(function() { $('#specialists_favorites').hide(); });
                        
                    -if current_user.favorite_clinics.blank?
                      :javascript
                        $(document).ready(function() { $('#clinics_favorites').hide(); });
                        
                    -if current_user.favorites.present?
                      :javascript
                        $(document).ready(function() { $('#add_favorites').hide(); });
                        
                %li.dropdown
                  %a.dropdown-toggle{"href" => "#", "data-toggle" => "dropdown"}
                    %i.icon-user
                    You
                    %b.caret
                  %ul.dropdown-menu
                    %li.nav-header.info= current_user.name
                    
                    - if current_user.controlled_specialists.present?
                      %li.nav-header Your specialists
                      - current_user.controlled_specialists.each do |specialist|
                        %li= link_to specialist.name, specialist, :class => 'ajax'
                    
                    - if current_user.controlled_clinics.present?
                      %li.nav-header Your clinics
                      - current_user.controlled_clinics.each do |clinic|
                        %li= link_to clinic.name, clinic, :class => 'ajax'
                    
                    %li.nav-header Settings
                    %li= link_to "Change name", change_name_path, :class => 'change_name ajax'
                    %li= link_to "Change e-mail address", change_email_path, :class => 'change_email ajax'
                    %li= link_to "Change password", change_password_path, :class => 'change_password ajax'
                    %li= link_to "Logout", logout_url, :class => 'logout'
                        

    #body.container
      .row
                    
        #content.span12
          #container
            - flash.each do |type, msg|
              .alert.alert-success= msg
            = yield
            
    #loading
